<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Contact</title>
  <meta name="referrer" content="origin">
  <link rel="stylesheet" href="style.css" />

  <!-- EmailJS (client-side) -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>

<body class="contact">
  <!-- Calque décoratif global -->
  <div class="bg-neon" aria-hidden="true"></div>

  <header>
    <h1>Contactez JO</h1>
    <nav><a href="index.html">Retour Accueil</a></nav>
  </header>

  <main>
    <div class="panel-contact">
      <div class="formulaire-contact">
        <h2>Contactez-moi</h2>

        <!-- Cible silencieuse pour FormSubmit -->
        <iframe name="fs_iframe" id="fs_iframe" style="display:none"></iframe>

        <form id="formulaire"
              action="https://formsubmit.co/b7d24ec775ed82703e9db3b554db2238"
              method="POST"
              novalidate
              target="fs_iframe">

          <!-- Options FormSubmit -->
          <input type="hidden" name="_subject" value="Nouveau message de contact !" />
          <input type="hidden" name="_captcha" value="false" />
          <input type="hidden" name="_template" value="table" />
          <!-- (on peut laisser l'autoresponse FormSubmit au cas où) -->
          <input type="hidden" name="_autoresponse" value="Votre message a bien été reçu." />
          <input type="hidden" name="_autoresponse_subject" value="Accusé de réception - Jo" />
          <!-- Pour que FormSubmit connaisse l'email expéditeur -->
          <input type="hidden" name="_replyto" id="_replyto" />

          <div class="champ">
            <label for="nom">Nom et Prénom :</label>
            <input type="text" id="nom" name="nom" />
          </div>

          <div class="champ">
            <label for="email">Email :</label>
            <input type="email" id="email" name="email" autocomplete="email" />
          </div>

          <div class="champ">
            <label for="sujet">Sujet :</label>
            <input type="text" id="sujet" name="sujet" />
          </div>

          <div class="champ">
            <label for="message">Message :</label>
            <textarea id="message" name="message" rows="5"></textarea>
          </div>

          <button type="submit">Envoyer</button>
        </form>
      </div>
    </div>
  </main>

  <footer><p>&copy; 2025 - Jo photographe</p></footer>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // === Identifiants EmailJS ===
      const EMAILJS_PUBLIC_KEY  = "Vi7031EvfHVnoZakw";
      const EMAILJS_SERVICE_ID  = "service_t1p1q8c";
      const EMAILJS_TEMPLATE_ID = "template_wi06tbl";

      // Init EmailJS si dispo
      if (window.emailjs && EMAILJS_PUBLIC_KEY) {
        emailjs.init(EMAILJS_PUBLIC_KEY);
      }

      const form = document.getElementById("formulaire");

      form.addEventListener("submit", function (e) {
        e.preventDefault(); // on reste sur la page
        let isValid = true;

        // Nettoyage
        form.querySelectorAll(".error-message").forEach((msg) => msg.remove());
        form.querySelectorAll("input, textarea").forEach((field) => field.classList.remove("invalid"));

        // Validation : uniquement les champs visibles
        form.querySelectorAll('input:not([type="hidden"]), textarea').forEach((field) => {
          const value = field.value.trim();
          let error = "";

          if (!value) {
            error = "Ce champ est requis.";
          } else if (field.type === "email" && !/^\S+@\S+\.\S+$/.test(value)) {
            error = "Adresse email invalide.";
          }

          if (error) {
            isValid = false;
            field.classList.add("invalid");
            const errorMsg = document.createElement("div");
            errorMsg.className = "error-message";
            errorMsg.textContent = error;
            field.parentNode.appendChild(errorMsg);
          }
        });

        if (!isValid) return;

        // Remplir _replyto pour FormSubmit
        document.getElementById("_replyto").value = document.getElementById("email").value.trim();

        // === Envoi FormSubmit (iframe) ===
        form.submit();

        // === Accusé de réception via EmailJS (variables: email, nom, sujet, message) ===
        if (window.emailjs && EMAILJS_PUBLIC_KEY && EMAILJS_SERVICE_ID && EMAILJS_TEMPLATE_ID) {
          const params = {
            email:   document.getElementById("email").value.trim(),   // {{email}}
            nom:     document.getElementById("nom").value.trim() || " ", // {{nom}}
            sujet:   document.getElementById("sujet").value.trim(),      // {{sujet}}
            message: document.getElementById("message").value.trim()     // {{message}} si utilisé
          };

          emailjs
            .send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, params)
            .then(() => console.log("Auto-réponse envoyée via EmailJS"),
                  (err) => console.warn("EmailJS error:", err));
        }

        // Message succès + reset
        const success = document.createElement("div");
        success.className = "success-message";
        success.textContent = "Message envoyé avec succès !";
        form.appendChild(success);

        setTimeout(() => form.reset(), 0);
        setTimeout(() => success.classList.add("fade-out"), 9000);
        setTimeout(() => success.remove(), 10000);
      });
    });
  </script>
</body>
</html>
