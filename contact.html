<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Contact</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body class="contact">
  <div class="bg-neon" aria-hidden="true"></div>

  <header>
    <h1>Contactez JO</h1>
    <nav><a href="index.html">Retour Accueil</a></nav>
  </header>

  <main>
    <div class="panel-contact">
      <div class="formulaire-contact">
        <h2>Contactez-moi</h2>

        <!-- Cible silencieuse -->
        <iframe name="fs_iframe" id="fs_iframe" style="display:none"></iframe>

        <form id="formulaire"
              action="https://formsubmit.co/b7d24ec775ed82703e9db3b554db2238"
              method="POST"
              novalidate
              target="fs_iframe">

          <!-- Options FormSubmit -->
          <input type="hidden" name="_subject" value="Nouveau message de contact !" />
          <input type="hidden" name="_captcha" value="false" />
          <input type="hidden" name="_template" value="table" />
          <input type="hidden" name="_autoresponse" value="Votre message a bien été reçu.">
          <input type="hidden" name="_autoresponse_subject" value="Accusé de réception - Jo">
          <!-- important pour l'autoresponse -->
          <input type="hidden" name="_replyto" id="_replyto" />

          <div class="champ">
            <label for="nom">Nom et Prénom :</label>
            <input type="text" id="nom" name="nom" />
          </div>

          <div class="champ">
            <label for="email">Email :</label>
            <input type="email" id="email" name="email" autocomplete="email" />
          </div>

          <div class="champ">
            <label for="sujet">Sujet :</label>
            <input type="text" id="sujet" name="sujet" />
          </div>

          <div class="champ">
            <label for="message">Message :</label>
            <textarea id="message" name="message" rows="5"></textarea>
          </div>

          <button type="submit">Envoyer</button>
        </form>
      </div>
    </div>
  </main>

  <footer><p>&copy; 2025 - Jo photographe</p></footer>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form   = document.getElementById("formulaire");
      const iframe = document.getElementById("fs_iframe");

      // petit indicateur quand FormSubmit répond
      if (iframe) {
        iframe.addEventListener("load", function () {
          console.log("FormSubmit a répondu (iframe load).");
        });
      }

      form.addEventListener("submit", function (e) {
        e.preventDefault(); // on garde la page
        let isValid = true;

        // Nettoyage
        form.querySelectorAll(".error-message").forEach((msg) => msg.remove());
        form.querySelectorAll("input, textarea").forEach((field) => field.classList.remove("invalid"));

        // Validation : uniquement les champs visibles
        form.querySelectorAll('input:not([type="hidden"]), textarea').forEach((field) => {
          const value = field.value.trim();
          let error = "";

          if (!value) {
            error = "Ce champ est requis.";
          } else if (field.type === "email" && !/^\S+@\S+\.\S+$/.test(value)) {
            error = "Adresse email invalide.";
          }

          if (error) {
            isValid = false;
            field.classList.add("invalid");
            const errorMsg = document.createElement("div");
            errorMsg.className = "error-message";
            errorMsg.textContent = error;
            field.parentNode.appendChild(errorMsg);
          }
        });

        if (!isValid) return;

        // Renseigner _replyto avec l'adresse saisie
        document.getElementById("_replyto").value =
          document.getElementById("email").value.trim();

        // Envoi vers FormSubmit (dans l'iframe cachée)
        form.submit();

        // Succès visuel + reset (tes timings)
        const success = document.createElement("div");
        success.className = "success-message";
        success.textContent = "Message envoyé avec succès !";
        form.appendChild(success);

        setTimeout(() => form.reset(), 0);
        setTimeout(() => success.classList.add("fade-out"), 9000);
        setTimeout(() => success.remove(), 10000);
      });
    });
  </script>
</body>
</html>
